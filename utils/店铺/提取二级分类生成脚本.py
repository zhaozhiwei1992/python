"""
将美团导出的二级分类转换成分类脚本
将excel数据放入vim中替换处理，然后放入程序中进行转换
"""
import urllib.parse

def generate_sub_category_sql(category_data):
    """
    将分类数据转换为SQL插入语句的Python函数，根据child_name去重

    Args:
        category_data (str): 格式为"一级分类>二级分类;一级分类>二级分类"的字符串

    Returns:
        str: 生成的SQL插入语句
    """
    # 一级分类名称到ID的映射
    parent_category_map = {
        '猫咪主粮': 1,
        '猫咪零食': 2,
        '猫咪玩具': 3,
        '猫砂盆铲': 4,
        '狗狗主粮': 5,
        '狗狗零食': 6,
        '狗狗玩具': 7,
        '营养保健': 8,
        '卫生美容': 9,
        '疾病护理': 10,
        '食具水具': 11,
        '出行必备': 12,
        '猫狗服饰': 13,
        '窝垫笼子': 14,
        '尿垫厕所': 15,
        '犬猫驱虫': 16,
        '热销推荐': 17
    }

    # 分割字符串，每条记录用分号分隔
    records = [record.strip() for record in category_data.split(';') if record.strip()]

    sql_statements = []
    sub_category_id = 100  # 二级分类ID从100开始，避免与一级分类冲突

    # 用于去重的集合，记录已经处理过的child_name
    processed_child_names = set()

    for index, record in enumerate(records):
        parts = record.split('>')
        if len(parts) < 2:
            print(f"警告: 第{index + 1}条记录格式错误: {record}")
            continue

        parent_name = parts[0].strip()
        child_name = parts[1].strip()

        if not parent_name or not child_name:
            print(f"警告: 第{index + 1}条记录格式错误: {record}")
            continue

        # 检查child_name是否已存在
        if child_name in processed_child_names:
            print(f"提示: 二级分类'{child_name}'已存在，跳过重复记录")
            continue

        parent_id = parent_category_map.get(parent_name)
        if not parent_id:
            print(f"警告: 未知的一级分类: {parent_name}")
            continue

        # 将child_name添加到已处理集合
        processed_child_names.add(child_name)

        # URL编码子分类名称用于图片URL
        encoded_child_name = urllib.parse.quote(child_name)

        # 构建SQL值元组
        sql_value = f"({sub_category_id}, {parent_id}, '{child_name}', 'http://example.com/{encoded_child_name}.jpg', {index + 1}, 0, 'system', NOW(), 'system', NOW(), 0, 1)"
        sql_statements.append(sql_value)
        sub_category_id += 1

    if not sql_statements:
        return '-- 没有有效的二级分类数据'

    # 构建完整的SQL插入语句
    sql_header = """-- 插入二级分类（根据Excel数据生成）
-- 注意：已根据child_name自动去重
INSERT INTO `product_category`
(`id`, `parent_id`, `name`, `pic_url`, `sort`, `status`, `creator`, `create_time`, `updater`, `update_time`, `deleted`, `tenant_id`) VALUES
"""

    return sql_header + ',\n'.join(sql_statements) + ';'

# 使用示例
if __name__ == "__main__":
    # 测试数据（包含重复的二级分类）
    excel_data = "猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>零食冻干;猫咪零食>猫条餐包;出行必备>其它出行用品;卫生美容>沐浴用品;卫生美容>沐浴用品;疾病护理>皮肤护理;狗狗零食>饼干冻干;猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>主食罐头;猫咪零食>零食罐头;猫咪零食>零食罐头;猫咪零食>猫草薄荷饼干棒棒;猫咪零食>零食冻干;猫咪主粮>小包主粮;猫咪主粮>小包主粮;猫咪零食>猫条餐包;猫咪零食>零食罐头;狗狗零食>罐头肉包;狗狗零食>罐头肉包;猫咪玩具>逗猫棒;狗狗零食>罐头肉包;狗狗零食>罐头肉包;猫咪玩具>趣味自嗨;猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>猫草薄荷饼干棒棒;猫咪玩具>猫抓板;卫生美容>沐浴用品;卫生美容>沐浴用品;卫生美容>沐浴用品;猫咪零食>零食罐头;猫咪零食>零食罐头;狗狗零食>罐头肉包;猫咪零食>猫条餐包;狗狗零食>肉干磨牙;狗狗零食>肉干磨牙;狗狗零食>肉干磨牙;狗狗零食>肉干磨牙;狗狗零食>肉干磨牙;狗狗零食>饼干冻干;猫咪零食>猫条餐包;猫咪零食>猫条餐包;狗狗零食>火腿肠咕噜酱;猫咪零食>猫条餐包;猫咪零食>主食罐头;猫咪零食>猫草薄荷饼干棒棒;猫咪玩具>趣味自嗨;猫咪玩具>逗猫棒;猫咪零食>零食罐头;猫咪零食>零食罐头;猫咪零食>零食罐头;卫生美容>洗澡洗护;猫咪零食>主食罐头;猫咪零食>零食冻干;猫咪零食>零食罐头;猫咪零食>零食罐头;猫咪零食>猫草薄荷饼干棒棒;猫咪玩具>趣味自嗨;猫咪零食>零食罐头;狗狗零食>罐头肉包;狗狗零食>罐头肉包;狗狗零食>罐头肉包;卫生美容>沐浴用品;卫生美容>沐浴用品;猫咪零食>零食冻干;猫咪零食>零食冻干;猫咪玩具>逗猫棒;猫咪零食>零食罐头;猫咪零食>零食罐头;狗狗零食>罐头肉包;狗狗零食>罐头肉包;猫咪零食>零食冻干;猫咪零食>零食罐头;窝垫笼子>窝垫;窝垫笼子>窝垫;猫咪零食>猫草薄荷饼干棒棒;猫狗服饰>宠物项圈/围脖;窝垫笼子>产房;猫咪玩具>趣味自嗨;猫砂盆铲>猫砂铲;卫生美容>梳子指甲剪;食具水具>勺/奶瓶/喂药;食具水具>勺/奶瓶/喂药;猫咪零食>主食罐头;猫咪玩具>逗猫棒;卫生美容>梳子指甲剪;猫咪零食>猫草薄荷饼干棒棒;狗狗零食>罐头肉包;猫咪零食>猫条餐包;出行必备>其它出行用品;卫生美容>沐浴用品;狗狗零食>罐头肉包;狗狗零食>罐头肉包;狗狗零食>罐头肉包;狗狗零食>火腿肠咕噜酱;狗狗零食>火腿肠咕噜酱;狗狗零食>火腿肠咕噜酱;猫咪零食>零食冻干;猫咪零食>主食罐头;猫咪零食>主食罐头;狗狗零食>饼干冻干;猫咪零食>猫草薄荷饼干棒棒;猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>猫条餐包;卫生美容>洗澡洗护;猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>猫条餐包;食具水具>宠物碗/碟;食具水具>宠物碗/碟;卫生美容>梳子指甲剪;狗狗零食>罐头肉包;狗狗零食>罐头肉包;猫咪零食>零食冻干;猫咪零食>零食冻干;猫咪零食>零食冻干;猫咪零食>零食冻干;猫咪零食>零食冻干;疾病护理>伊丽莎白圈/绝育;疾病护理>伊丽莎白圈/绝育;疾病护理>伊丽莎白圈/绝育;疾病护理>伊丽莎白圈/绝育;卫生美容>沐浴用品;狗狗零食>罐头肉包;猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>零食罐头;猫咪零食>零食冻干;猫咪零食>零食罐头;狗狗零食>肉干磨牙;狗狗主粮>全阶段犬粮;猫咪主粮>成猫粮;猫咪零食>零食冻干;狗狗零食>饼干冻干;猫咪主粮>全阶段猫粮;卫生美容>消毒清洁;卫生美容>消毒清洁;营养保健>宠物羊奶粉;猫咪主粮>成猫粮;狗狗零食>罐头肉包;猫砂盆铲>猫砂盆;疾病护理>猫咪发情;卫生美容>消毒清洁;猫咪主粮>小包主粮;食具水具>一体式喂食;狗狗零食>肉干磨牙;食具水具>宠物饮水机;营养保健>宠物羊奶粉;猫咪主粮>幼猫奶糕粮;营养保健>综合微量营养;狗狗主粮>幼犬奶糕粮;营养保健>宠物羊奶粉;狗狗主粮>成犬粮;营养保健>综合微量营养;出行必备>航空箱猫包;狗狗主粮>全阶段犬粮;猫咪主粮>全阶段猫粮;出行必备>航空箱猫包;出行必备>其它出行用品;狗狗零食>肉干磨牙;猫咪零食>零食冻干狗狗零食>饼干冻干;猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>猫条餐包;狗狗玩具;卫生美容>梳子指甲剪;卫生美容>梳子指甲剪;狗狗零食>饼干冻干;猫咪零食>零食冻干狗狗零食>饼干冻干;卫生美容>梳子指甲剪;卫生美容>梳子指甲剪;猫咪零食>猫条餐包;狗狗零食>肉干磨牙;窝垫笼子>窝垫;窝垫笼子>窝垫;猫咪零食>零食冻干;猫咪零食>猫条餐包;狗狗零食>饼干冻干;猫咪玩具>逗猫棒;卫生美容>梳子指甲剪;卫生美容>梳子指甲剪;卫生美容>梳子指甲剪;食具水具>宠物碗/碟;食具水具>宠物碗/碟;食具水具>宠物碗/碟;猫咪零食>猫草薄荷饼干棒棒;猫咪零食>猫条餐包;猫咪零食>猫条餐包;狗狗玩具;狗狗玩具;狗狗主粮>成犬粮;出行必备>其它出行用品;出行必备>其它出行用品;猫咪零食>主食罐头;猫咪零食>主食罐头;猫咪主粮>全阶段猫粮;狗狗主粮>小包尝鲜;狗狗主粮>幼犬奶糕粮;狗狗零食>肉干磨牙;猫咪零食>猫条餐包;营养保健>护肤美毛;猫咪零食>猫条餐包;营养保健>宠物羊奶粉;食具水具>宠物碗/碟;食具水具>宠物碗/碟;卫生美容>沐浴用品;疾病护理>眼部护理;卫生美容>沐浴用品;疾病护理>眼部护理;卫生美容>其他日用;狗狗零食>饼干冻干;狗狗零食>罐头肉包;猫咪零食>猫条餐包;狗狗零食>罐头肉包;猫咪零食>猫条餐包;狗狗零食>罐头肉包;猫咪零食>猫条餐包;狗狗零食>罐头肉包;猫咪零食>猫条餐包;猫咪零食>主食罐头;狗狗零食>罐头肉包;狗狗零食>肉干磨牙;狗狗零食>罐头肉包;狗狗零食>罐头肉包;食具水具>勺/奶瓶/喂药;卫生美容>梳子指甲剪;卫生美容>梳子指甲剪;营养保健>健骨补钙;狗狗零食>罐头肉包;猫咪零食>零食罐头;狗狗零食>罐头肉包;猫咪零食>零食罐头;狗狗零食>罐头肉包;猫咪零食>零食罐头;狗狗零食>罐头肉包;猫咪零食>零食罐头;狗狗零食>罐头肉包;猫咪零食>零食罐头;狗狗零食>罐头肉包;猫咪零食>零食罐头;猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>猫条餐包;营养保健>护肤美毛;猫咪玩具>逗猫棒;猫狗服饰>宠物项圈/围脖;疾病护理>伊丽莎白圈/绝育;猫狗服饰>宠物项圈/围脖;疾病护理>伊丽莎白圈/绝育;猫狗服饰>宠物项圈/围脖;疾病护理>伊丽莎白圈/绝育;食具水具>宠物碗/碟;食具水具>宠物碗/碟;猫咪零食>零食罐头;猫咪零食>零食罐头;猫咪零食>零食罐头;猫咪零食>零食罐头;猫狗服饰>绝育服;猫狗服饰>绝育服;猫狗服饰>绝育服;猫狗服饰>绝育服;猫狗服饰>绝育服;猫狗服饰>绝育服;猫咪零食>猫条餐包;猫咪零食>猫条餐包;窝垫笼子>窝垫;狗狗零食>饼干冻干;狗狗零食>肉干磨牙;狗狗零食>肉干磨牙;窝垫笼子>窝垫;窝垫笼子>窝垫;窝垫笼子>窝垫;卫生美容>沐浴用品;疾病护理>皮肤护理;猫咪主粮>小包主粮;狗狗零食>饼干冻干;狗狗零食>饼干冻干;猫砂盆铲>猫砂铲;猫咪零食>零食冻干;狗狗主粮>全阶段犬粮;狗狗零食>肉干磨牙;狗狗零食>火腿肠咕噜酱;卫生美容>其他日用;狗狗零食>肉干磨牙;狗狗零食>肉干磨牙;狗狗零食>肉干磨牙;狗狗零食>肉干磨牙;猫咪主粮>全阶段猫粮;猫咪主粮>全阶段猫粮;营养保健>宠物羊奶粉;出行必备>其它出行用品;出行必备>其它出行用品;猫咪主粮>全阶段猫粮;卫生美容>消毒清洁;卫生美容>消毒清洁;猫砂盆铲>优质猫砂;营养保健>营养膏/化毛膏;猫咪玩具>逗猫棒;狗狗零食>肉干磨牙;狗狗零食>罐头肉包;狗狗零食>罐头肉包;猫砂盆铲>优质猫砂;狗狗零食>火腿肠咕噜酱;猫咪主粮>成猫粮;猫狗服饰>宠物背心;猫狗服饰>宠物背心;猫狗服饰>宠物背心;猫狗服饰>宠物背心;;猫砂盆铲>优质猫砂;狗狗零食>罐头肉包;营养保健>营养膏/化毛膏;营养保健>营养膏/化毛膏;狗狗零食>肉干磨牙;;猫砂盆铲>优质猫砂;疾病护理>口腔/泌尿;营养保健>其他保健品;卫生美容>沐浴用品;卫生美容>沐浴用品;猫咪主粮>幼猫奶糕粮;卫生美容>消毒清洁;营养保健>护肤美毛;疾病护理>眼部护理;狗狗零食>肉干磨牙;猫咪零食>猫草薄荷饼干棒棒;猫咪零食>零食冻干;狗狗零食>饼干冻干;猫咪零食>零食冻干;狗狗零食>饼干冻干;猫咪零食>零食冻干;狗狗零食>肉干磨牙;猫咪零食>猫条餐包;猫咪零食>猫条餐包;猫咪零食>猫条餐包;狗狗零食>肉干磨牙;狗狗零食>肉干磨牙;窝垫笼子>窝垫;窝垫笼子>窝垫;狗狗零食>肉干磨牙;狗狗零食>肉干磨牙;狗狗零食>肉干磨牙;疾病护理>皮肤护理;猫狗服饰>宠物背心;猫狗服饰>宠物背心;猫狗服饰>宠物背心;猫狗服饰>宠物背心;猫狗服饰>宠物背心;猫狗服饰>宠物背心;猫狗服饰>宠物背心;猫狗服饰>宠物背心;猫咪主粮>小包主粮;猫咪零食>猫草薄荷饼干棒棒;疾病护理>耳部护理;狗狗零食>肉干磨牙;狗狗零食>肉干磨牙;营养保健>肠胃调理;疾病护理>肠胃调节;营养保健>综合微量营养;窝垫笼子>窝垫;窝垫笼子>窝垫;窝垫笼子>窝垫;营养保健>肠胃调理;疾病护理>肠胃调节;出行必备>其它出行用品;营养保健>健骨补钙;猫砂盆铲>优质猫砂;狗狗零食>肉干磨牙;狗狗零食>肉干磨牙;狗狗零食>肉干磨牙;狗狗零食>肉干磨牙;狗狗零食>肉干磨牙;猫咪零食>主食罐头;猫咪零食>主食罐头;卫生美容>沐浴用品;卫生美容>沐浴用品;卫生美容>沐浴用品;猫咪零食>主食罐头;狗狗零食>火腿肠咕噜酱;猫咪零食>主食罐头;狗狗零食>火腿肠咕噜酱;猫砂盆铲>优质猫砂;;猫砂盆铲>优质猫砂;窝垫笼子>窝垫;窝垫笼子>窝垫;猫咪零食>猫草薄荷饼干棒棒;猫咪零食>主食罐头;猫咪零食>主食罐头;猫咪零食>猫条餐包;狗狗零食>肉干磨牙;狗狗零食>肉干磨牙;营养保健>肠胃调理;疾病护理>肠胃调节;营养保健>肠胃调理;疾病护理>肠胃调节;卫生美容>梳子指甲剪;狗狗零食>火腿肠咕噜酱;尿垫厕所>尿垫狗厕所;;营养保健>宠物羊奶粉;疾病护理>耳部护理;出行必备>牵引绳胸背;出行必备>牵引绳胸背;出行必备>牵引绳胸背;出行必备>牵引绳胸背;营养保健>肠胃调理;疾病护理>肠胃调节;狗狗零食>肉干磨牙;狗狗主粮>成犬粮;营养保健>健骨补钙;营养保健>健骨补钙;猫咪零食>零食冻干;猫咪零食>零食冻干;猫咪零食>猫条餐包;猫咪零食>猫条餐包;卫生美容>消毒清洁;尿垫厕所>尿垫狗厕所;卫生美容>梳子指甲剪;卫生美容>沐浴用品;尿垫厕所>尿垫狗厕所;尿垫厕所>尿垫狗厕所;尿垫厕所>尿垫狗厕所;尿垫厕所>尿垫狗厕所;猫咪零食>零食罐头;营养保健>营养膏/化毛膏;营养保健>营养膏/化毛膏;猫咪主粮>成猫粮;猫咪零食>零食冻干;猫咪主粮>全阶段猫粮;疾病护理>眼部护理;营养保健>护肤美毛;猫咪零食>零食冻干;猫咪主粮>成猫粮;猫咪零食>零食冻干;猫咪主粮>成猫粮;营养保健>宠物羊奶粉;猫咪主粮>全阶段猫粮;营养保健>营养膏/化毛膏;疾病护理>肠胃调节;猫砂盆铲>优质猫砂;窝垫笼子>窝垫;猫砂盆铲>猫砂盆;狗狗主粮>幼犬奶糕粮;猫咪主粮>全阶段猫粮;猫咪主粮>全阶段猫粮;营养保健>营养膏/化毛膏;狗狗主粮>全阶段犬粮;食具水具>一体式喂食;出行必备>航空箱猫包;出行必备>航空箱猫包;出行必备>航空箱猫包;狗狗主粮>幼犬奶糕粮;猫咪主粮>全阶段猫粮;猫咪主粮>全阶段猫粮;猫咪主粮>全阶段猫粮;猫咪主粮>成猫粮;猫咪主粮>成猫粮;狗狗主粮>成犬粮;猫咪主粮>全阶段猫粮;出行必备>航空箱猫包;猫咪主粮>成猫粮;猫咪主粮>幼猫奶糕粮;狗狗主粮>全阶段犬粮;狗狗主粮>成犬粮;狗狗主粮>成犬粮;猫咪主粮>小包主粮;猫咪主粮>小包主粮;狗狗主粮>幼犬奶糕粮;狗狗主粮>成犬粮;狗狗主粮>幼犬奶糕粮;"

    # 生成SQL
    result_sql = generate_sub_category_sql(excel_data)
    print(result_sql)

    # 打印统计信息
    print(f"\n处理完成，成功生成 {len(result_sql.split('),'))} 条不重复的二级分类记录")